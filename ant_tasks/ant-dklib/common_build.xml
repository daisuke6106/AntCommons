<?xml version="1.0" encoding="UTF-8" ?>

<project name="common_ant" default="all" basedir=".">

  <!--================================================-->
  <!-- 初期化 -->
  <!--================================================-->
  <target name="init">
    <property file="./build.properties"/>
  	<path id="_init.path.id">
  	  <fileset dir="${library.dir}" includes="*.jar"/>
  	</path>
  	<path id="_init.path.id.test">
  	  <fileset dir="${library.dir}" includes="*.jar"/>
  	  <fileset dir="${test.library.dir}" includes="*.jar"/>
  	</path>
  	<pathconvert property="_library.jars" refid="_init.path.id"/>
  	<pathconvert property="_test.library.jars" refid="_init.path.id.test"/>
  	
  	<echo message="${_test.library.jars}"/>
  	
  </target>
  
  <!--================================================-->
  <!-- コンパイル -->
  <!--================================================-->
  <target name="compile" depends="init">
  	<delete dir="${compile.delete.dir}" />
  	<mkdir dir="${compile.mkdir.dir}" />
    <javac srcdir      = "${compile.javac.srcdir}"
           destdir     = "${compile.javac.destdir}"
           deprecation = "${compile.javac.deprecation}"
           debug       = "${compile.javac.debug}"
           encoding    = "${compile.javac.encoding}"
           classpath   = "${compile.javac.classpath};${_library.jars}"
           includeantruntime="false"/>
  	<copy todir="${compile.copy.todir}">
  	  <fileset dir="${compile.copy.fileset.dir}">
  	  	<include name="${compile.copy.fileset.include.name}"/>
  	    <exclude name="${compile.copy.fileset.exclude.name}"/>
   	  </fileset>
   	</copy>
  </target>
  
  <!--================================================-->
  <!-- テスト用クラスコンパイル -->
  <!--================================================-->
  <target name="test.compile" depends="init">
  	<delete dir="${test.compile.delete.dir}" />
  	<mkdir dir="${test.compile.mkdir.dir}" />
    <javac srcdir      = "${test.compile.javac.srcdir}"
           destdir     = "${test.compile.javac.destdir}"
           deprecation = "${test.compile.javac.deprecation}"
           debug       = "${test.compile.javac.debug}"
           encoding    = "${test.compile.javac.encoding}"
           classpath   = "${test.compile.javac.classpath};${_test.library.jars}"
           includeantruntime="false"
           />
  	<copy todir="${test.compile.copy.todir}">
  		<fileset dir="${test.compile.copy.fileset.dir}">
  		  <include name="${test.compile.copy.fileset.include.name}"/>
  		  <exclude name="${test.compile.copy.fileset.exclude.name}"/>
  		</fileset>
  	</copy>
  </target>
	  
  <!--================================================-->
  <!-- JARを作成 -->
  <!--================================================-->
  <target name="jar" depends="compile">
  	<delete dir="${jar.delete.dir}" />
  	<jar jarfile  = "${jar.jar.jarfile}"
         basedir  = "${jar.jar.basedir}" />
  </target>
  
  <!--================================================-->
  <!-- テスト用JARを作成 -->
  <!--================================================-->
  <target name="test.jar" depends="test.compile">
  	<delete dir="${test.jar.delete.dir}" />
  	<jar jarfile  = "${test.jar.jar.jarfile}"
         basedir  = "${test.jar.jar.basedir}" />
  </target>
  
  <!--================================================-->
  <!-- javadocを生成 -->
  <!--================================================-->
  <target name="doc" depends="init">
  	<delete dir="${doc.delete.dir}"/>
    <mkdir  dir="${doc.mkdir.dir}" />
    <javadoc locale       = "${doc.jacadoc.locale}"
             charset      = "${doc.jacadoc.charset}"
             encoding     = "${doc.jacadoc.encoding}"
             docencoding  = "${doc.jacadoc.docencoding}"
             classpath    = "${doc.jacadoc.classpath}/*.jar"
             sourcepath   = "${doc.jacadoc.sourcepath}"
             packagenames = "${doc.jacadoc.packagenames}"
             destdir      = "${doc.jacadoc.destdir}">
    </javadoc>
  </target>

  <!--================================================-->
  <!-- テストを実行 -->
  <!--================================================-->
  <target name="test.execute" depends="init">
  	<junit fork="${test.execute.junit.fork}" haltonfailure="${test.execute.junit.haltonfailure}">
	    <test name="jp.co.dk.message.test.TestCaseMessage" />
        <formatter type="plain" usefile="false" />
	  	<classpath>
	  	  <pathelement location="${_test.library.jars}" />
	  	  <pathelement location="${test.execute.junit.classpath.pathelement.location.test_jar}" />
	  	  <pathelement location="${test.execute.junit.classpath.pathelement.location.jar}" />
        </classpath>
	  </junit>
  </target>
  
  <!--================================================-->
  <!-- FindBugs実行 -->
  <!--================================================-->
  <target name="findbugs.execute">
  	<taskdef name="findbugs" classname="edu.umd.cs.findbugs.anttask.FindBugsTask" classpath="./lib/test/findbugs-ant.jar:./lib/test/findbugs.jar:"/>
  	<findbugs home="" output="text" outputFile="findbugs_report.txt">
  		<auxClassPath path="${_library.jars}"/>
  		<sourcePath path="scr"/>
  		<class location=",.message.jar"/>
  	</findbugs>
  </target>
  
  
  <!--================================================-->
  <!-- ビルド用フォルダを削除 -->
  <!--================================================-->
  <target name="clean" depends="init">
    <delete dir="${clean.delete.dir}" />
  </target>
  
  <!--================================================-->
  <!-- 全ジョブ実行 -->
  <!--================================================-->
  <target name="all">
    <antcall target="jar"/>
  	<antcall target="test.jar"/>
  	<antcall target="doc"/>
  	<antcall target="test.execute"/>
  	<antcall target="clean"/>
  </target>
</project>
